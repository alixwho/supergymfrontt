<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/login"></ion-back-button>
    </ion-buttons>
    <ion-title>Crear cuenta</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <form [formGroup]="formRegistro" (ngSubmit)="registrar()" class="ion-padding">

    <ion-item>
      <ion-label position="stacked">Número de usuario</ion-label>
      <ion-input formControlName="numero_usuario" placeholder="Ej. usuario123"></ion-input>
    </ion-item>
    @if (formRegistro.get('numero_usuario')?.touched && formRegistro.get('numero_usuario')?.hasError('required')) {
      <p class="error">Este campo es obligatorio.</p>
    }

    <ion-item>
      <ion-label position="stacked">Nombre completo</ion-label>
      <ion-input formControlName="name" placeholder="Tu nombre"></ion-input>
    </ion-item>
    @if (formRegistro.get('name')?.touched && formRegistro.get('name')?.hasError('required')) {
      <p class="error">El nombre es obligatorio.</p>
    }

    <ion-item>
      <ion-label position="stacked">Correo electrónico</ion-label>
      <ion-input formControlName="email" placeholder="tucorreo@email.com" type="email"></ion-input>
    </ion-item>
    @if (formRegistro.get('email')?.touched && formRegistro.get('email')?.hasError('required')) {
      <p class="error">El correo es obligatorio.</p>
    }
    @if (formRegistro.get('email')?.touched && formRegistro.get('email')?.hasError('email')) {
      <p class="error">Ingresa un correo válido.</p>
    }

    <ion-item>
      <ion-label position="stacked">Contraseña</ion-label>
      <ion-input
        [type]="mostrarContrasena ? 'text' : 'password'"
        formControlName="password"
        placeholder="••••••••">
      </ion-input>
      <ion-icon
        slot="end"
        [name]="mostrarContrasena ? 'eye-off' : 'eye'"
        class="icono-ojo"
        (click)="cambiarVisibilidadContrasena()">
      </ion-icon>
    </ion-item>
    @if (formRegistro.get('password')?.touched && formRegistro.get('password')?.hasError('required')) {
      <p class="error">La contraseña es obligatoria.</p>
    }
    @if (formRegistro.get('password')?.touched && formRegistro.get('password')?.hasError('minlength')) {
      <p class="error">Debe tener al menos 6 caracteres.</p>
    }

    <ion-item>
      <ion-label position="stacked">Confirmar contraseña</ion-label>
      <ion-input
        [type]="mostrarConfirmar ? 'text' : 'password'"
        formControlName="confirmarPassword"
        placeholder="••••••••">
      </ion-input>
      <ion-icon
        slot="end"
        [name]="mostrarConfirmar ? 'eye-off' : 'eye'"
        class="icono-ojo"
        (click)="cambiarVisibilidadConfirmacion()">
      </ion-icon>
    </ion-item>
    
    @if (formRegistro.errors?.['noCoinciden'] && formRegistro.get('confirmarPassword')?.touched) {
      <p class="error">Las contraseñas no coinciden.</p>
    }

    <ion-item>
      <ion-label position="stacked">Edad</ion-label>
      <ion-input type="number" formControlName="edad" placeholder="25"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Género</ion-label>
      <ion-select formControlName="sexo" placeholder="Seleccionar">
        <ion-select-option value="masculino">Masculino</ion-select-option>
        <ion-select-option value="femenino">Femenino</ion-select-option>
        <ion-select-option value="otro">Otro</ion-select-option>
      </ion-select>
    </ion-item>

    <div class="peso-altura">
      <ion-item>
        <ion-label position="stacked">Peso (kg)</ion-label>
        <ion-input type="number" formControlName="peso" placeholder="70"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Altura (cm)</ion-label>
        <ion-input type="number" formControlName="altura" placeholder="175"></ion-input>
      </ion-item>
    </div>

    <ion-item>
      <ion-label position="stacked">Nivel de conocimiento</ion-label>
      <ion-select formControlName="nivel_conocimiento" placeholder="Seleccionar">
        <ion-select-option value="Principiante">Principiante</ion-select-option>
        <ion-select-option value="Intermedio">Intermedio</ion-select-option>
        <ion-select-option value="Avanzado">Avanzado</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Objetivo</ion-label>
      <ion-input formControlName="objetivo" placeholder="Bajar de peso, ganar masa..."></ion-input>
    </ion-item>


    <ion-item style="display: none;">
      <ion-label position="stacked">Tipo de usuario</ion-label>
      <ion-input formControlName="tipo_usuario" value="Registrado"></ion-input>
    </ion-item>

    <ion-button
      expand="block"
      class="register-btn"
      [disabled]="cargando || formRegistro.invalid"
      type="submit">
      {{ cargando ? 'Registrando...' : 'Registrarse' }}
    </ion-button>
  </form>
</ion-content>
